<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Personal blog of Aaron S. Randreth - creative writing, technical posts, and more">
  <meta name="author" content="Aaron S. Randreth">

  <title>Fix SSL Certificate Issues in Corporate Linux Environment.
 - Aaron S. Randreth</title>

  <!-- Open Graph for social sharing -->
  <meta property="og:title" content="Fix SSL Certificate Issues in Corporate Linux Environment.
">
  <meta property="og:description" content="Personal blog of Aaron S. Randreth">
  <meta property="og:type" content="website">

  <meta name="theme-color" content="#ffb2db">

  <link rel="stylesheet" href="/css/style.css"/>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"/>

  <!-- Enables auto discovery for rss -->
  
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://aaron-randreth.com/rss.xml">
  
</head>

<body>
<nav>
  <a id="logo" href="/">
    <i class="bi bi-house-fill"></i></a>
  <div id="search">
    <input type="text" placeholder="Search..."></input>
    <button disabled><i class="bi bi-search-heart-fill"></i></button>
    <ul id="results">
    </ul>
  </div>
</nav>

<main>
  <section class="section">
    
<h1 class="title">
  Fix SSL Certificate Issues in Corporate Linux Environment.

</h1>
<ul class="metadata">
  
    <li><i class="bi bi-clock"></i>4 minutes</li>
  
  <li><i class="bi bi-pencil"></i>Fri, 25 Jul 2025</li>
  <li><i class="bi bi-feather"></i> Aaron RANDRETH </li>
</ul>

<h2 id="introduction">Introduction</h2>
<p>While using a Virtual Machine (VM) on your company laptop, you might have encountered unexplained SSL certificate errors and big red warnings on your favorite browser inside this VM. If your network works perfectly fine outside your VM, then you might be missing the correct certificates.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">[I]</span><span> localhost@aaron </span><span style="color:#bf616a;">~ </span><span style="color:#b48ead;">[</span><span>60</span><span style="color:#b48ead;">]</span><span>&gt; curl https://self-signed.badssl.com/
</span><span style="color:#bf616a;">curl:</span><span> (60) </span><span style="color:#bf616a;">SSL</span><span> certificate problem: self-signed certificate
</span><span style="color:#bf616a;">More</span><span> details here: https://curl.se/docs/sslcerts.html
</span><span>
</span><span style="color:#bf616a;">curl</span><span> failed to verify the legitimacy of the server and therefore could not
</span><span style="color:#bf616a;">establish</span><span> a secure connection to it. To learn more about this situation and
</span><span style="color:#bf616a;">how</span><span> to fix it, please visit the webpage mentioned above.
</span></code></pre>
<span id="continue-reading"></span><h2 id="why-this-might-be-happening">Why this might be happening</h2>
<blockquote>
<p>If you want to directly go to the solution, skip this section and move on to the next.</p>
</blockquote>
<p>When making an HTTPS request, the remote server will add a cryptographic signature to the data it is sending you, so that you can verify that it is free from any third-party tampering. To know that you are talking to the right server, and not just trusting any random signature, we rely on <a href="https://en.wikipedia.org/wiki/Certificate_authority">Certificate Authorities</a> (CAs). They are the organisations that allow us to verify the identity of our correspondent.</p>
<p>Like many other companies, my company is using a VPN solution for security and logistics purposes. In my case, it was Global Protect from Palo Alto Networks.</p>
<p>This VPN is always on and configured to be used for every network connection. As a  consequence, it effectively performs a <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">Man-in-the-middle attack</a> on every connection your computer makes. The gist of it is that the VPN will intercept all HTTPS connections and re-sign the HTTPS certificates with its own CA. This is a common corporate security practice, not malicious behavior. Your VM only trusts the standard public CAs, not your company’s internal CA, so all your tools will realize that the signature is not the correct one for the URL you are trying to access.</p>
<p>To fix this, we need to add our company’s CAs to our machine.
Other guides for this issue exist, but they assume you already have the certificates, or that you can easily get them from your IT department. My IT department however is pretty busy, and it’s not the easiest to get a hold of them. I needed to find a solution that did not involve them at all.</p>
<h2 id="brief-overview">Brief overview</h2>
<p>My host Windows computer only had Microsoft Edge, and I am using Firefox on my guest Debian VM, so that’s what I will be using in this tutorial. If you have any other setup, you can rely on this overview and adapt it to your setup.</p>
<p>To fix our certificate problem, we will extract a certificate bundle from our host machine, using a working browser. After extracting individual certificates from this bundle, we will install those certificates on our Debian machine.</p>
<p>We will also configure the browser on our guest system, as they sometimes ignore the system certificates.</p>
<h2 id="getting-and-adding-the-certificates">Getting and adding the certificates</h2>
<p>First, on your host machine:</p>
<ol>
<li><strong>In Edge:</strong>
<ul>
<li>Go to <code>Settings &gt; Privacy, search, and services &gt; Security &gt; Manage certificates</code></li>
<li>Click <code>View imported certificates from Windows</code></li>
<li>At the top of the <code>Trusted Certificates</code> category, click <code>Export</code> to export them all as a single .crt file</li>
</ul>
</li>
</ol>
<p>Now, in your guest machine:</p>
<ol start="2">
<li>This file contains several certificates, but the Debian certificate manager only handles one certificate per file. So we need to split the certificates.</li>
</ol>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">csplit</span><span> trusted_certs.crt \
</span><span style="color:#bf616a;">    --elide-empty-files </span><span>\
</span><span style="color:#bf616a;">    --prefix</span><span>=&#39;</span><span style="color:#a3be8c;">company-cert-</span><span>&#39; \
</span><span style="color:#bf616a;">    --suffix-format</span><span>=&#39;</span><span style="color:#a3be8c;">%02d.crt</span><span>&#39; \
</span><span>    &#39;</span><span style="color:#a3be8c;">/-----BEGIN CERTIFICATE-----/</span><span>&#39; &#39;</span><span style="color:#a3be8c;">{*}</span><span>&#39;
</span></code></pre>
<ol start="3">
<li>We now need to move the certificates to the correct directory, and notify the manager:</li>
</ol>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> cp company-cert-*.crt /usr/local/share/ca-certificates/
</span><span style="color:#bf616a;">sudo</span><span> update-ca-certificates
</span></code></pre>
<p>You should see in the output all your certificates being added.</p>
<p>All new processes should now use those new certificates. You can verify this by opening a new terminal and launching:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">wget --spider</span><span> https://gitlab.freedesktop.org
</span></code></pre>
<ol start="4">
<li>(Optional) By default, Firefox and other browsers do not use the system certificates, so some websites may still not work.
To fix that for Firefox, go to <code>Settings &gt; Privacy &amp; Security &gt; View Certificates &gt; Import</code>. And import the trusted_certs.crt certificate.</li>
</ol>
<h2 id="alternative-method">Alternative Method</h2>
<p>If you only want to get the certificates for a specific website, you can visit it on a machine that is correctly set up, and check in your browser by which certificate it was issued. You can then copy this directly to the certificates folder on the other machine, and update the certs.</p>


<style>


</style>
<nav id="back-btn">
  
  <i class="bi bi-arrow-left"><a href="https:&#x2F;&#x2F;aaron-randreth.com&#x2F;blog&#x2F;">Back</a></i>
</nav>


  </section>
  <footer>
    <p>Made using <a href="https://www.getzola.org">Zola</a>.<i class="bi bi-balloon-heart-fill"></i></p>
    <p><a href="/rss.xml">Subscribe</a> with RSS. <i class="bi bi-rss-fill"></i></p>
  </footer>
</main>

<script src="https://aaron-randreth.com/elasticlunr.min.js"></script>
<script src="https://aaron-randreth.com/search_index.en.js"></script>
<script>
  const searchIndex = elasticlunr.Index.load(window.searchIndex);
  const resultsContainer = document.getElementById('results');

  document.getElementById('search').addEventListener('input', function(e) {
    const results = searchIndex.search(
      e.target.value, 
      {expand: true, bool: "OR"}
    );
   resultsContainer.innerHTML = '';
 
   results.forEach(result => {
     const parentLi = document.createElement('li');
     const link = document.createElement('a');
     link.href = result.ref;
     link.textContent = result.doc.title;
     parentLi.appendChild(link);
     resultsContainer.appendChild(parentLi);
   });
});
</script>

</body>

</html>

